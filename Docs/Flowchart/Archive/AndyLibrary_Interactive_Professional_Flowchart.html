
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AndyLibrary Interactive Professional Process Flowchart</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/panzoom@9.4.3/dist/panzoom.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 auto;
            max-width: 98%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.8em;
            margin: 0;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.3em;
            margin: 10px 0 0 0;
            font-weight: 600;
        }
        
        .diagram-container {
            text-align: center;
            background: #ffffff;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #ecf0f1;
            position: relative;
            overflow: hidden;
            height: 800px;
        }
        
        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .zoom-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        
        .zoom-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }
        
        .pan-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .mermaid {
            background: #ffffff;
            border-radius: 8px;
            padding: 30px;
            font-family: 'Arial', sans-serif !important;
            transform-origin: center;
            transition: transform 0.3s ease;
        }
        
        /* Enhanced text styling for better visibility */
        .mermaid svg {
            font-family: 'Arial', sans-serif !important;
            font-weight: bold !important;
            background: #ffffff !important;
        }
        
        .mermaid .node text {
            font-family: 'Arial', sans-serif !important;
            font-size: 14px !important;
            font-weight: 900 !important;
            fill: #000000 !important;
            stroke: none !important;
        }
        
        .mermaid .edgeLabel {
            background: #ffffff !important;
        }
        
        .mermaid .edgeLabel text {
            font-family: 'Arial', sans-serif !important;
            font-size: 13px !important;
            font-weight: 900 !important;
            fill: #000000 !important;
            stroke: #ffffff !important;
            stroke-width: 2px !important;
            paint-order: stroke fill !important;
        }
        
        .mermaid .edgeLabel rect {
            fill: #ffffff !important;
            stroke: #333333 !important;
            stroke-width: 1px !important;
            opacity: 1.0 !important;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .legend {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .legend h3 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.4em;
            font-weight: 700;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 4px;
            border: 2px solid #333;
        }
        
        .feature-info {
            margin-top: 25px;
            padding: 20px;
            background: #e8f4fd;
            border-radius: 8px;
            border: 1px solid #3498db;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                max-width: none;
            }
            .controls, .feature-info, .zoom-controls, .pan-info {
                display: none;
            }
            .diagram-container {
                height: auto;
                overflow: visible;
            }
            .mermaid {
                page-break-inside: avoid;
                transform: scale(0.8);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è AndyLibrary Process Flowchart</h1>
            <p>Interactive Professional Edition ‚Ä¢ Zoom & Pan Enabled</p>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="window.print()">üñ®Ô∏è Print Diagram</button>
            <button class="btn" onclick="downloadFixedSVG()">üíæ Download SVG</button>
            <button class="btn" onclick="downloadPNG()">üì∑ Download PNG</button>
            <button class="btn" onclick="resetZoom()">üîÑ Reset View</button>
            <button class="btn" onclick="toggleFullscreen()">üîç Fullscreen</button>
        </div>
        
        <div class="diagram-container" id="diagramContainer">
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">‚àí</button>
                <button class="zoom-btn" onclick="resetZoom()" title="Reset">‚åÇ</button>
            </div>
            <div class="pan-info">
                üí° Drag to pan ‚Ä¢ Scroll to zoom ‚Ä¢ Click controls to navigate
            </div>
            <div class="mermaid" id="mermaidDiagram">

flowchart TD
    %% Interactive Professional AndyLibrary User Process Flowchart
    %% Optimized for presentations with zoom/pan and fixed SVG export
    
    %% Start/End Nodes
    START([üöÄ START<br/><b>User Opens Browser</b>])
    END([‚úÖ END<br/><b>Book Access Complete</b>])
    
    %% Main Process Flow
    POWER_ON[‚ö° POWER ON<br/><b>Load Website</b>]
    SCAN_ENV[üîç SCAN ENVIRONMENT<br/><b>Check Auth Status</b>]
    GEN_MAP[üó∫Ô∏è GENERATE MAP<br/><b>Load User Interface</b>]
    PLAN_ROUTE[üéØ PLAN ROUTE<br/><b>Choose Auth Method</b>]
    
    %% Authentication Decision
    AUTH_CHECK{üîê USER<br/><b>AUTHENTICATED?</b>}
    
    %% Registration Flow
    VAC_ON[üîÑ VACUUM ON<br/><b>Start Registration</b>]
    REG_VALID{‚úÖ REGISTRATION<br/><b>VALID?</b>}
    SEND_EMAIL[üìß SEND VERIFICATION<br/><b>Email Process</b>]
    EMAIL_SENT{üì§ EMAIL<br/><b>SENT?</b>}
    VACUUM_FULL{üìß EMAIL<br/><b>VERIFIED?</b>}
    TOKEN_VALID{üé´ TOKEN<br/><b>VALID?</b>}
    
    %% Login Flow  
    LOGIN_PROCESS[üîë LOGIN PROCESS<br/><b>Authenticate User</b>]
    USER_FOUND{üë§ USER<br/><b>FOUND?</b>}
    BATTERY_LOW{üîí ACCOUNT<br/><b>LOCKED?</b>}
    LOGIN_SUCCESS{‚úÖ LOGIN<br/><b>SUCCESSFUL?</b>}
    
    %% Data Storage
    ROUTE[(üíæ USER DATABASE<br/><b>Store User Data</b>)]
    
    %% Google Drive Integration
    GDRIVE_SETUP[‚òÅÔ∏è GOOGLE DRIVE SETUP<br/><b>OAuth Configuration</b>]
    GDRIVE_AUTH{üåê GOOGLE DRIVE<br/><b>AUTHORIZED?</b>}
    FIND_FOLDER[üìÅ FIND LIBRARY FOLDER<br/><b>Search Google Drive</b>]
    FOLDER_EXISTS{üìÇ LIBRARY FOLDER<br/><b>EXISTS?</b>}
    BOOK_SEARCH[üìö SEARCH BOOK FILE<br/><b>Locate Requested Book</b>]
    FILE_FOUND{üìñ BOOK FILE<br/><b>FOUND?</b>}
    
    %% Error States
    ERROR_IND[üö® ERROR INDICATOR ON<br/><b>Show Error Message</b>]
    DUPLICATE_USER[‚ùå DUPLICATE USER<br/><b>Email Already Exists</b>]
    VAC_OFF_1[üî¥ VACUUM OFF<br/><b>Email Verification Failed</b>]
    TOKEN_EXPIRED[‚è∞ TOKEN EXPIRED<br/><b>Request New Verification</b>]
    USER_NOT_FOUND[‚ùå USER NOT FOUND<br/><b>Invalid Credentials</b>]
    VAC_OFF_2[üî¥ VACUUM OFF<br/><b>Google Drive Failed</b>]
    STOP_MOVING[üõë STOP MOVING<br/><b>Registration Failed</b>]
    
    %% Action States
    RETURN_DOCK[üè† RETURN TO DOCK<br/><b>Show Login Form</b>]
    POWER_OFF[‚èπÔ∏è POWER OFF<br/><b>Session Expired</b>]
    
    %% MAIN FLOW CONNECTIONS
    START --> POWER_ON
    POWER_ON --> SCAN_ENV
    SCAN_ENV --> GEN_MAP
    GEN_MAP --> PLAN_ROUTE
    PLAN_ROUTE --> AUTH_CHECK
    
    %% AUTHENTICATION DECISION
    AUTH_CHECK -->|<b>‚ùå NO</b>| VAC_ON
    AUTH_CHECK -->|<b>‚úÖ YES</b>| GDRIVE_SETUP
    
    %% REGISTRATION FLOW
    VAC_ON --> REG_VALID
    REG_VALID -->|<b>‚úÖ YES</b>| SEND_EMAIL
    REG_VALID -->|<b>‚ùå NO</b>| DUPLICATE_USER
    
    SEND_EMAIL --> EMAIL_SENT
    EMAIL_SENT -->|<b>‚úÖ YES</b>| VACUUM_FULL
    EMAIL_SENT -->|<b>‚ùå NO</b>| VAC_OFF_1
    
    VACUUM_FULL -->|<b>‚úÖ YES</b>| TOKEN_VALID
    VACUUM_FULL -->|<b>‚ùå NO</b>| VAC_OFF_1
    
    TOKEN_VALID -->|<b>‚úÖ YES</b>| LOGIN_PROCESS
    TOKEN_VALID -->|<b>‚ùå NO</b>| TOKEN_EXPIRED
    
    %% LOGIN FLOW
    LOGIN_PROCESS --> USER_FOUND
    USER_FOUND -->|<b>‚úÖ YES</b>| BATTERY_LOW
    USER_FOUND -->|<b>‚ùå NO</b>| USER_NOT_FOUND
    
    BATTERY_LOW -->|<b>‚ùå NO</b>| LOGIN_SUCCESS
    BATTERY_LOW -->|<b>üîí YES</b>| RETURN_DOCK
    
    LOGIN_SUCCESS -->|<b>‚úÖ YES</b>| ROUTE
    LOGIN_SUCCESS -->|<b>‚ùå NO</b>| RETURN_DOCK
    
    %% DATABASE STORAGE
    ROUTE --> GDRIVE_SETUP
    
    %% GOOGLE DRIVE FLOW
    GDRIVE_SETUP --> GDRIVE_AUTH
    GDRIVE_AUTH -->|<b>‚úÖ YES</b>| FIND_FOLDER
    GDRIVE_AUTH -->|<b>‚ùå NO</b>| VAC_OFF_2
    
    FIND_FOLDER --> FOLDER_EXISTS
    FOLDER_EXISTS -->|<b>‚úÖ YES</b>| BOOK_SEARCH
    FOLDER_EXISTS -->|<b>‚ùå NO</b>| VAC_OFF_2
    
    BOOK_SEARCH --> FILE_FOUND
    FILE_FOUND -->|<b>‚úÖ YES</b>| END
    FILE_FOUND -->|<b>‚ùå NO</b>| VAC_OFF_2
    
    %% ACTION FLOW
    RETURN_DOCK --> POWER_OFF
    POWER_OFF --> END
    
    %% ERROR RECOVERY FLOWS
    DUPLICATE_USER --> ERROR_IND
    STOP_MOVING --> ERROR_IND
    VAC_OFF_1 --> ERROR_IND
    TOKEN_EXPIRED --> ERROR_IND
    USER_NOT_FOUND --> ERROR_IND
    VAC_OFF_2 --> ERROR_IND
    ERROR_IND -.->|<b>üîÑ RETRY</b>| PLAN_ROUTE
    
    %% INTERACTIVE PROFESSIONAL STYLING WITH LARGER TEXT
    classDef startEndClass fill:#e1f5fe,stroke:#01579b,stroke-width:4px,color:#000000,font-size:16px,font-weight:900
    classDef processClass fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000000,font-size:15px,font-weight:800
    classDef decisionClass fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000000,font-size:15px,font-weight:800
    classDef storageClass fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px,color:#000000,font-size:15px,font-weight:800
    classDef errorClass fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000000,font-size:15px,font-weight:800
    classDef actionClass fill:#f1f8e9,stroke:#33691e,stroke-width:3px,color:#000000,font-size:15px,font-weight:800
    
    %% APPLY INTERACTIVE STYLES
    class START,END startEndClass
    class POWER_ON,SCAN_ENV,GEN_MAP,PLAN_ROUTE,VAC_ON,SEND_EMAIL,LOGIN_PROCESS,GDRIVE_SETUP,FIND_FOLDER,BOOK_SEARCH processClass
    class AUTH_CHECK,REG_VALID,EMAIL_SENT,VACUUM_FULL,TOKEN_VALID,USER_FOUND,BATTERY_LOW,LOGIN_SUCCESS,GDRIVE_AUTH,FOLDER_EXISTS,FILE_FOUND decisionClass
    class ROUTE storageClass
    class ERROR_IND,DUPLICATE_USER,VAC_OFF_1,TOKEN_EXPIRED,USER_NOT_FOUND,VAC_OFF_2,STOP_MOVING errorClass
    class RETURN_DOCK,POWER_OFF actionClass

            </div>
        </div>
        
        <div class="legend">
            <h3>üìã Interactive Process Legend</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e1f5fe; border-color: #01579b;"></div>
                    <span><strong>Start/End:</strong> Entry and exit points</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f3e5f5; border-color: #4a148c;"></div>
                    <span><strong>Process:</strong> System operations</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3e0; border-color: #e65100;"></div>
                    <span><strong>Decision:</strong> Yes/No choice points</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f5e8; border-color: #2e7d32;"></div>
                    <span><strong>Storage:</strong> Database operations</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffebee; border-color: #c62828;"></div>
                    <span><strong>Error:</strong> Failure states</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f1f8e9; border-color: #33691e;"></div>
                    <span><strong>Action:</strong> User interface actions</span>
                </div>
            </div>
        </div>
        
        <div class="feature-info">
            <p><strong>üéØ Interactive Features:</strong> Zoom & Pan Controls ‚Ä¢ 
            Fixed SVG Export with Solid Backgrounds ‚Ä¢ High-Resolution Downloads ‚Ä¢ 
            Professional Presentation Quality ‚Ä¢ Executive-Ready Design</p>
        </div>
    </div>

    <script>
        let panzoom;
        
        // Initialize Mermaid with enhanced settings
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            },
            themeVariables: {
                primaryColor: '#f3e5f5',
                primaryTextColor: '#000000',
                primaryBorderColor: '#4a148c',
                lineColor: '#333333',
                sectionBkgColor: '#ffffff',
                altSectionBkgColor: '#f8f9fa',
                gridColor: '#e1e1e1',
                secondaryColor: '#fff3e0',
                tertiaryColor: '#e1f5fe',
                fontSize: '16px',
                fontFamily: 'Arial, sans-serif',
                background: '#ffffff'
            }
        });
        
        // Initialize pan/zoom after Mermaid renders
        setTimeout(() => {
            const element = document.getElementById('mermaidDiagram');
            panzoom = Panzoom(element, {
                maxScale: 3,
                minScale: 0.3,
                startScale: 0.8,
                cursor: 'grab'
            });
            
            // Add mouse wheel zoom
            element.parentElement.addEventListener('wheel', panzoom.zoomWithWheel);
        }, 1000);
        
        // Zoom controls
        function zoomIn() {
            if (panzoom) panzoom.zoomIn();
        }
        
        function zoomOut() {
            if (panzoom) panzoom.zoomOut();
        }
        
        function resetZoom() {
            if (panzoom) panzoom.reset();
        }
        
        // Fixed SVG download with solid backgrounds
        function downloadFixedSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                // Clone the SVG to modify it
                const clonedSvg = svg.cloneNode(true);
                
                // Set white background
                clonedSvg.style.background = '#ffffff';
                clonedSvg.setAttribute('style', 'background: #ffffff');
                
                // Add background rectangle
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('width', '100%');
                rect.setAttribute('height', '100%');
                rect.setAttribute('fill', '#ffffff');
                clonedSvg.insertBefore(rect, clonedSvg.firstChild);
                
                // Ensure all text elements have proper styling with solid backgrounds
                const textElements = clonedSvg.querySelectorAll('text');
                textElements.forEach(text => {
                    text.style.fontFamily = 'Arial, sans-serif';
                    text.style.fontWeight = 'bold';
                    text.style.fontSize = text.classList.contains('edgeLabel') ? '13px' : '14px';
                    text.style.fill = '#000000';
                    text.setAttribute('font-family', 'Arial, sans-serif');
                    text.setAttribute('font-weight', 'bold');
                    text.setAttribute('fill', '#000000');
                });
                
                // Ensure all edge label backgrounds are solid white
                const edgeLabels = clonedSvg.querySelectorAll('.edgeLabel rect');
                edgeLabels.forEach(rect => {
                    rect.setAttribute('fill', '#ffffff');
                    rect.setAttribute('stroke', '#333333');
                    rect.setAttribute('stroke-width', '1');
                    rect.setAttribute('opacity', '1');
                });
                
                // Add comprehensive styling
                const defs = clonedSvg.querySelector('defs') || document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                if (!clonedSvg.querySelector('defs')) {
                    clonedSvg.insertBefore(defs, clonedSvg.firstChild);
                }
                
                const style = document.createElementNS('http://www.w3.org/2000/svg', 'style');
                style.textContent = `
                    svg {
                        background: #ffffff !important;
                    }
                    text {
                        font-family: Arial, sans-serif !important;
                        font-weight: bold !important;
                        fill: #000000 !important;
                    }
                    .edgeLabel text {
                        font-size: 13px !important;
                        font-weight: 900 !important;
                        stroke: #ffffff !important;
                        stroke-width: 2px !important;
                        paint-order: stroke fill !important;
                    }
                    .edgeLabel rect {
                        fill: #ffffff !important;
                        stroke: #333333 !important;
                        opacity: 1 !important;
                    }
                `;
                defs.appendChild(style);
                
                // Serialize and download
                const serializer = new XMLSerializer();
                const source = '<?xml version="1.0" encoding="UTF-8"?>\n' + serializer.serializeToString(clonedSvg);
                const blob = new Blob([source], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'AndyLibrary_Interactive_Professional_Flowchart.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
        
        // PNG download function
        function downloadPNG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Create a properly formatted SVG string with white background
                const svgClone = svg.cloneNode(true);
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('width', '100%');
                rect.setAttribute('height', '100%');
                rect.setAttribute('fill', '#ffffff');
                svgClone.insertBefore(rect, svgClone.firstChild);
                
                const data = new XMLSerializer().serializeToString(svgClone);
                const blob = new Blob([data], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const img = new Image();
                
                img.onload = function() {
                    canvas.width = img.width * 2; // Higher resolution
                    canvas.height = img.height * 2;
                    ctx.scale(2, 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                    
                    canvas.toBlob(function(pngBlob) {
                        const pngUrl = URL.createObjectURL(pngBlob);
                        const a = document.createElement('a');
                        a.href = pngUrl;
                        a.download = 'AndyLibrary_Interactive_Professional_Flowchart.png';
                        a.click();
                        URL.revokeObjectURL(pngUrl);
                    }, 'image/png');
                    
                    URL.revokeObjectURL(url);
                };
                
                img.src = url;
            }
        }
        
        // Fullscreen toggle
        function toggleFullscreen() {
            const container = document.getElementById('diagramContainer');
            if (!document.fullscreenElement) {
                container.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // Enhanced print optimization
        window.addEventListener('beforeprint', function() {
            if (panzoom) panzoom.reset();
        });
    </script>
</body>
</html>
